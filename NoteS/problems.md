# Мои мысли

## Проблемы

> Решение проблем, это компромисс между ресурсами, дальнейшей поддержкой и безопасностью. К счастью, я не связан
> контрактными и денежными обязательствами, а также не заинтересован лично, потому все решения будут приниматься в
> пользу
> экономии времени. До тех пор пока работает, плевать как это грязно.

Какая-то канбан доска вышла, лул
- ![#c5f015](https://placehold.co/15x15/c5f015/c5f015.png) Таблички `note_types` и `syntax_type` в сущности не нужны и их в принципе можно бы убрать. Однако я не понимаю как
  иначе это сделать, поэтому оставлю оба решения, пусть будут стеклянным замком. Лучшее решение будет стоить слишком
  много человекочасов.
- ![#c5f015](https://placehold.co/15x15/c5f015/c5f015.png) Таблица тегов нужна ли она вообще? Просто мешанина из тегов, которые доступны всем.
  Кмк это решение однопользовательской парадигмы, натянутое на многопользовательское. Я бы назвал это ключевой проблемой
  всего проекта. Он решает странную пролблему, хранения локальных заметок онлайн. ЗАЧЕМ?

  На данный момент костылем будет просто вставка Owner к каждому тегу, притом ослабление уникальности. Возможно сделать
  PK над id юзера и самим текстом тега.

  Уточняя, составной пк над юзером и текстом + UQ синтетического ключа, автогенерируемого секвенсом. Грязь та еще.
- ![#c5f015](https://placehold.co/15x15/c5f015/c5f015.png) Я интересным образом встроил комментарии, что более не отображено в схемках. Если подумать, то там есть модерация,
  однако я просто не стану всю эту муть реализовывать, не имеет смысла.
- ![#1589F0](https://placehold.co/15x15/1589F0/1589F0.png) Приложение требует просто колоссального кол-ва оперативной памяти. Основная причина оверхед на виртуализацию контейнеров и elastic. Как вариант решения запускать все (ну или хотя бы часть) контейнеры на ноуте (0.0.0.0 очевидно).
- ![#1589F0](https://placehold.co/15x15/1589F0/1589F0.png) Будем искренне надеяться, что возможность поставить родителя к каждой ноте не создаст циклы. В теории, если дать юзеру эту возможность, то они естественно возникнут.. Но мы же не дадим, да?)
- ![#c5f015](https://placehold.co/15x15/c5f015/c5f015.png) В asp ОРМ унылое говно, которое не может нормально управлять бакетами, создавая не общий, а индивидуальный для каждого контекста. Зачем их столько, неясно, но решением пусть будет везде ставить детач. Да, вероятно это породит просто огромную кучу запросов, но как-то плевать.
  
  Детачи происходят на выходе Save и прочих методов репозиториев. Интересен тут сам факт, что нам требуется сделать прослойку из вызовов кучи методов преобразователей: Поиск по строке -> детач -> маппинг на дто.
  Встает вопрос, а есть ли случаи когда этот бакет необходим? Предполагаю, что проще изначально давать отдетаченные и не заморачиваться с этим вовсе. Потом, вспоминая для чего я делал эти дто на уровне сервисов, то понимаем, что проблемы изначально не стоит. Следовательно следующее упрощение - просто вообще не использовать дто на уровне сервисов. 
- Не работает 403 Challenge, пока хз че делать. 
- ![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) Одно название `Note` как энтити и как типа. Возможно `Entry`. 
- ![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) Смешение синхронщины и асинхронщины
- ![#c5f015](https://placehold.co/15x15/c5f015/c5f015.png) Мне прям понравилось, то как я сделал DTO для филдов и использовал имлиситы. Крутая штука, хоть что-то мне понравилось в этом недоязыке
- ![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) На самом деле очень много полей в сущностях, часть необязательны, часть обязательны. По хорошему придумать способ, обозначать, что именно мне надо в определенном методе. Хотя конечно у меня и есть неплохая идея с DTO - филдами, но не знаю пока как это совместить. 
- ![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) `#region` кажется чем-то прикольным
- ![#f03c15](https://placehold.co/15x15/f03c15/f03c15.png) кажется неплохой идеей, сопоставить необязательные поля из json body, `null => old value`. Т.е. скажем эндпоинт на редактирование и если пользователь не указал в json поле тайтла, то значит он не хочет его редактировать, а не установить равным `null`. Плюс это удобство в том плане, что не боишься повредить что-то. 
- ![#cc8899](https://placehold.co/15x15/cc8899/cc8899.png) Мейби избранные заметки добавить
- 
## Упрощения

> Иногда компромиссы доходят до крайних форм, искажая суть, но таков путь.

- Уберем типы блоков.
- Уберем сами блоки, оставив в `notes` вместо контента ссылку на id в elastic.
  - Синтаксис также теперь для всей записки, а не одного конкретного блока. 
- 

## Словарь
- Поиск (Search) - по совпадению, $[0..\infty]$
- Получение (Get) - точно, даже если частично совпало, все равно не будет в выборке $[0..1]$
- Допустим, что приватное апи - это апи с повышенными привилегиями (aka `sudo`), а не в том плане, что оно закрыто от кого-то, хотя и в тч так. Как следствие, публичное апи - апи доступное с дефолтными привилегиями. Повысить привилегии можно только имея админ доступ в keycloak.
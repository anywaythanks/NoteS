<app-menu></app-menu>
<main>
  @if (note != undefined) {
    <app-copy [data]="pageUrl()" [icon]="faLink"></app-copy>
    @if (isOwner) {
      <div class="icon-toggle">
        <label class="eye-toggle">
          <input type="checkbox"
                 [(ngModel)]="isPublic"
                 (click)="togglePublic()"
                 [disabled]="!isEditMode"
                 class="hidden-checkbox">
          <fa-icon [icon]="isPublic?faEye:faEyeSlash"
                   [class]="isPublic?'eye-icon':'eye-slash-icon'"></fa-icon>
        </label>
      </div>
      <div class="icon-toggle">
        <label class="edit-toggle">
          <input type="checkbox"
                 [(ngModel)]="isEditMode"
                 (click)="toggleEdit()"
                 class="hidden-checkbox">
          <fa-icon [icon]="isEditMode?faBookOpen:faPen"
                   [class]="isEditMode?'edit-icon':'not-edit-icon'"></fa-icon>
        </label>
      </div>
    }
    @if (isEditMode) {
      <div>
        <button (click)="deleteNote()" class="icon-button">
          <fa-icon [icon]="faTrash" class="delete-icon"></fa-icon>
        </button>
      </div>
      <div [class]="hasUnsavedChangesProp ? 'delete-wrap' : 'disable-delete-wrap'">
        <button (click)="saveChanges()" class="icon-button" [disabled]="!hasUnsavedChangesProp">
          <fa-icon [icon]="faFloppyDisk" class="delete-icon"></fa-icon>
        </button>
      </div>
      <div class="icon-toggle">
        <label class="preview-toggle">
          <input type="checkbox"
                 [(ngModel)]="isShowPreview"
                 (click)="togglePreview()"
                 class="hidden-checkbox">
          <fa-icon [icon]="faGlasses"
                   [class]="isShowPreview?'preview-icon':'not-preview-icon'"></fa-icon>
        </label>
      </div>
      <input type="text" (ngModelChange)="changeVals()" [(ngModel)]="title">
      <textarea (ngModelChange)="changeVals()" [(ngModel)]="description">
    </textarea>
      <form novalidate>
        <div class="editor">
          <angular-markdown-editor textareaId="editor1" [options]="editorOptions"
                                   [rows]=12 name="markdownText" [(ngModel)]="markdownText"
                                   (onFullscreenExit)="hidePreview()">
          </angular-markdown-editor>
        </div>
      </form>
      <hr/>

      @if (isShowPreview) {
        <div class="result-preview outline">
          <markdown katex mermaid [data]="markdownText"></markdown>
        </div>
      }
    } @else {
      <h1 class="note-title">{{ title }}</h1>
      <markdown katex mermaid [data]="markdownText"></markdown>
    }
    <div class="user-info"><span><fa-icon [icon]="faUser"></fa-icon>
      {{ note.owner_account_name }}</span>·<span></span><span><fa-icon [icon]="faClock"></fa-icon>
      {{ note.createdAtText }}</span></div>
    <details>
      <summary>Описание</summary>
      <div class="note-description">{{ description }}</div>
    </details>
    <app-tags [isEditMode]="isEditMode" [noteTags]="note.tags" [path]="uuid"></app-tags>
    <app-comments
      [uuid]="uuid"></app-comments>
  }
</main>
